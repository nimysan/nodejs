extends ../layout
block content
	div.container(class='container-body')
		link(rel='stylesheet', href='/dropzone/css/basic.css')
		link(rel='stylesheet', href='/dropzone/css/dropzone.css')
		ul(class="nav nav-tabs", role="tablist")
			-if (user && user.loginId === 'supervisor')
				li(role="presentation")
					a(href='#tab_passwordmanager',role="tab" data-toggle="tab", aria-controls="tab_passwordmanager") 更改用户密码
			li(role="presentation")
				a(href='#tab_studiomanager',role="tab" data-toggle="tab", aria-controls="tab_studiomanager") 影楼信息维护
			li.active(id='gallery',role="presentation")
				a(href='#tab_usermanager',role="tab" data-toggle="tab", aria-controls="tab_usermanager") 用户信息管理
		
		div.tab-content
			div#tab_passwordmanager(role="tabpanel" class="tab-pane fade")
				div#user_passpord_part(class="panel panel-info")
					div.panel-heading
						h2.panel-title 更改用户密码
					div.panel-body
						h2 更改用户密码
						div#user_password_form
			div#tab_studiomanager(role="tabpanel" class="tab-pane fade")
				div#studio_part(class="panel panel-info")
					div.panel-heading
						h2.panel-title 影楼信息更新
					div.panel-body
						div#studio_table_form
						
			div#tab_usermanager(role="tabpanel" class="tab-pane fade in active")
				div#file_upload_part(class="modal fade",role="dialog")
					div.modal-dialog
						div.modal-content
							div.modal-header
								button(type="button" ,class="close" , data-dismiss="modal")
									span(aria-hidden="true")&times;
									span.sr-only Close
								h2.modal-title 把文件拖到浏览器里面上传
							div.modal-body
								button(type='button', class='btn btn-danger', id='uploadButton', style='margin-bottom:6px;width: 100%;font-weight: bold;height: 4em;') 点击这个按钮上传
		
									span(class='glyphicon glyphicon-ok-upload')
								
								form#upyunDropzone(class='dropzone dz-clickable',action='http://v0.api.upyun.com/nimysan')
									div(class='dz-default dz-message')
										span 把文件拖入到这里上传
				
				div#user_part(class="panel panel-info")
					div.panel-heading
						h2.panel-title 用户信息管理
					div.panel-body
						h2 新增用户
						div(role='form', class="new_user_form")
							form.form-horizontal
								div#g_form_id(type='hidden') 
									div.form-group(class='has-feedback')
										div.input-group
											span(class='glyphicon glyphicon-user input-group-addon')
											input#u_login_name(type='text', class='form-control',placeholder='给用户选择一个登录的名字，注意是登录名字',value='')
									div.form-group(class='has-feedback')
										select#u_stuido.form-control
											option(value='')
											each studio in studios
												-if (studio)
													option(value='#{studio._id}')= studio.name
									button#u_create(type='button', class='btn btn-primary', style='margin-right: 20px;') 创建普通用户
										span(class='glyphicon glyphicon-ok-sign')
									if (user && user.loginId == 'supervisor')
										button#u_create_manager(type='button', class='btn btn-danger', style='margin-right: 20px;') 创建管理者账户
											span(class='glyphicon glyphicon-ok-sign')
						
						h2 所管理的用户
						table(class='table table-bordered table-hovered')
							tr
								th 用户名
								th 用户类型
								th 用户图片空间名字
								th 来自于（影楼）
								th 用户创建时间
								th 已付费
							each item in users
								tr.user_detail(user_id='#{item._id}')
									td.u-login-id
										a(href='/admin/resource/#{item.loginId}') #{item.loginId}
									- if (item.roles && item.roles.length == 1 && item.roles[0] == 'manager')
										td.u-role 
											span(class='glyphicon glyphicon-tree-conifer') 管理员
									- else
										td.u-role 
											span(class='glyphicon glyphicon-send') 普通用户
										
									td.u-image-path 
										a(href='/admin/fileupload/#{item.imagePath}',target='_blank') 管理用户照片
									- if (item.fromStudio )
										td.u-studio(studio_id='#{item.fromStudio._id}') 
											a(href='#{item.fromStudio.link}',target='_blank') #{item.fromStudio.name}
									- else
										td &nbsp;
									td #{item.date.toDateString()}
									- if (item.payed)
										td.u-payed 
											span(class='glyphicon glyphicon-ok-circle')
									- else
										td.u-payed 
											span(class='glyphicon glyphicon-remove-circle')
									
				
			
	script(src='/js/admin.js')
	script(src='http://cdn.bootcss.com/crypto-js/3.1.2/components/core-min.js')
	script(src='http://cdn.bootcss.com/crypto-js/3.1.2/components/md5.js')				
	script(src='/dropzone/dropzone.upyun.min.js')
	script(src='/js/fileupload.js')

			